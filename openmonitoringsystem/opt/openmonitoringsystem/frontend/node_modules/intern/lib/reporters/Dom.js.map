{"version":3,"file":"Dom.js","sourceRoot":"","sources":["../../../../src/lib/reporters/Dom.ts"],"names":[],"mappings":"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","sourcesContent":["import global from '@dojo/shim/global';\nimport { Executor } from '../executors/Executor';\nimport Reporter, { eventHandler, ReporterProperties } from './Reporter';\nimport Suite from '../Suite';\nimport Test from '../Test';\n\n/**\n * The Dom reporter outputs text into the DOM, essentially treating it like the\n * console.\n */\nexport default class Dom extends Reporter {\n\tdocument: HTMLDocument;\n\n\tsuiteNode: HTMLElement;\n\n\ttestNode: HTMLElement | undefined;\n\n\tconstructor(executor: Executor, options: DomOptions = {}) {\n\t\tsuper(executor, options);\n\t\tthis.document = options.document || document;\n\t\tthis.suiteNode = options.suiteNode || this.document.body;\n\t}\n\n\t@eventHandler()\n\terror(error: Error) {\n\t\tconst errorNode = this.document.createElement('pre');\n\t\terrorNode.appendChild(\n\t\t\tthis.document.createTextNode(this.formatError(error))\n\t\t);\n\t\tthis.document.body.appendChild(errorNode);\n\t}\n\n\t@eventHandler()\n\tsuiteEnd(suite: Suite) {\n\t\tthis.suiteNode = <HTMLElement>(this.suiteNode!.parentNode!.parentNode ||\n\t\t\tthis.document.body);\n\n\t\tif (suite.error) {\n\t\t\tthis.suiteNode.appendChild(\n\t\t\t\tthis.document.createTextNode('Suite \"' + suite.id + '\" failed')\n\t\t\t);\n\t\t\tthis.suiteNode.style.color = 'red';\n\n\t\t\tconst errorNode = this.document.createElement('pre');\n\t\t\terrorNode.appendChild(\n\t\t\t\tthis.document.createTextNode(this.formatError(suite.error))\n\t\t\t);\n\t\t\tthis.suiteNode.appendChild(errorNode);\n\t\t\tthis._scroll();\n\t\t}\n\t}\n\n\t@eventHandler()\n\tsuiteStart(suite: Suite) {\n\t\tconst oldSuiteNode = this.suiteNode;\n\t\tthis.suiteNode = this.document.createElement('ol');\n\n\t\tif (oldSuiteNode === this.document.body) {\n\t\t\toldSuiteNode.appendChild(this.suiteNode);\n\t\t} else {\n\t\t\tconst outerSuiteNode = this.document.createElement('li');\n\t\t\tconst headerNode = this.document.createElement('div');\n\n\t\t\theaderNode.appendChild(this.document.createTextNode(suite.name!));\n\t\t\touterSuiteNode.appendChild(headerNode);\n\t\t\touterSuiteNode.appendChild(this.suiteNode);\n\t\t\toldSuiteNode.appendChild(outerSuiteNode);\n\t\t}\n\n\t\tthis._scroll();\n\t}\n\n\t@eventHandler()\n\ttestEnd(test: Test) {\n\t\tif (test.skipped) {\n\t\t\tconst testNode = (this.testNode = this.document.createElement(\n\t\t\t\t'li'\n\t\t\t));\n\t\t\ttestNode.appendChild(\n\t\t\t\tthis.document.createTextNode(\n\t\t\t\t\ttest.name +\n\t\t\t\t\t\t' skipped' +\n\t\t\t\t\t\t(test.skipped ? ' (' + test.skipped + ')' : '')\n\t\t\t\t)\n\t\t\t);\n\t\t\ttestNode.style.color = 'gray';\n\t\t\tthis.suiteNode.appendChild(testNode);\n\t\t} else if (test.error) {\n\t\t\tconst testNode = this.testNode!;\n\t\t\ttestNode.appendChild(\n\t\t\t\tthis.document.createTextNode(\n\t\t\t\t\t' failed (' + test.timeElapsed + 'ms)'\n\t\t\t\t)\n\t\t\t);\n\t\t\ttestNode.style.color = 'red';\n\n\t\t\tconst errorNode = this.document.createElement('pre');\n\t\t\terrorNode.appendChild(\n\t\t\t\tthis.document.createTextNode(this.formatError(test.error))\n\t\t\t);\n\t\t\ttestNode.appendChild(errorNode);\n\t\t} else {\n\t\t\tconst testNode = this.testNode!;\n\t\t\ttestNode.appendChild(\n\t\t\t\tthis.document.createTextNode(\n\t\t\t\t\t' passed (' + test.timeElapsed + 'ms)'\n\t\t\t\t)\n\t\t\t);\n\t\t\ttestNode.style.color = 'green';\n\t\t}\n\t\tthis._scroll();\n\t}\n\n\t@eventHandler()\n\ttestStart(test: Test) {\n\t\tthis.testNode = this.document.createElement('li');\n\t\tthis.testNode.appendChild(this.document.createTextNode(test.name));\n\t\tthis.suiteNode.appendChild(this.testNode);\n\t\tthis._scroll();\n\t}\n\n\tprivate _scroll() {\n\t\tglobal.scrollTo(\n\t\t\t0,\n\t\t\tthis.document.documentElement.scrollHeight ||\n\t\t\t\tthis.document.body.scrollHeight\n\t\t);\n\t}\n}\n\nexport interface DomProperties extends ReporterProperties {\n\tdocument: Document;\n\tsuiteNode: HTMLElement;\n}\n\nexport type DomOptions = Partial<DomProperties>;\n"]}