{"version":3,"file":"main.js","sourceRoot":"","sources":["main.ts"],"names":[],"mappings":"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","sourcesContent":["import { Command, EjectOutput, Helper, OptionsHelper } from '@dojo/interfaces/cli';\nimport { ExternalDep } from '@dojo/webpack-contrib/external-loader-plugin/ExternalLoaderPlugin';\nimport { underline } from 'chalk';\nimport * as fs from 'fs';\nimport * as net from 'net';\nimport * as path from 'path';\nimport webpack = require('webpack');\n\nconst WebpackDevServer: any = require('webpack-dev-server');\nconst config: ConfigFactory = require('./webpack.config');\nconst pkgDir = require('pkg-dir');\n\nconst portRangeDelimeter = ':';\nconst portListDelimeter = ',';\nconst defaultPortRange = '9999:9990';\n\nfunction portStringToInt(portString: string) {\n\treturn parseInt(portString, 10);\n}\n\nexport interface Bundles {\n\t[key: string]: string[];\n}\n\nexport interface BuildArgs {\n\t[index: string]: any;\n\tmessageBundles: string | string[];\n\tsupportedLocales: string | string[];\n\twatch: boolean;\n\tport: string;\n\telement: string;\n\telementPrefix: string;\n\twithTests: boolean;\n\tdebug: boolean;\n\tdisableLazyWidgetDetection: boolean;\n\tbundles: Bundles;\n\texternals: { outputPath?: string; dependencies: ExternalDep[] };\n\tfeatures: string | string[];\n\tforce: boolean;\n}\n\ninterface ConfigFactory {\n\t(args: Partial<BuildArgs>): webpack.Config;\n}\n\ninterface WebpackOptions {\n\tcompress: boolean;\n\tstats: {\n\t\tcolors: boolean\n\t\tchunks: boolean\n\t};\n}\n\nfunction getConfigArgs(args: BuildArgs): Partial<BuildArgs> {\n\tconst { messageBundles, supportedLocales, watch } = args;\n\tconst options: Partial<BuildArgs> = Object.keys(args).reduce((options: Partial<BuildArgs>, key: string) => {\n\t\tif (key !== 'messageBundles' && key !== 'supportedLocales') {\n\t\t\toptions[key] = args[key];\n\t\t}\n\t\treturn options;\n\t}, Object.create(null));\n\n\tif (messageBundles) {\n\t\toptions.messageBundles = Array.isArray(messageBundles) ? messageBundles : [ messageBundles ];\n\t}\n\n\tif (supportedLocales) {\n\t\toptions.supportedLocales = Array.isArray(supportedLocales) ? supportedLocales : [ supportedLocales ];\n\t}\n\n\tif (args.element && !args.elementPrefix) {\n\t\tconst factoryPattern = /create(.*?)Element.*?\\.ts$/;\n\t\tconst matches = args.element.match(factoryPattern);\n\n\t\tif (matches && matches[ 1 ]) {\n\t\t\toptions.elementPrefix = matches[ 1 ].replace(/[A-Z][a-z]/g, '-\\$&').replace(/^-+/g, '').toLowerCase();\n\t\t}\n\t\telse {\n\t\t\tconsole.error(`\"${args.element}\" does not follow the pattern \"createXYZElement\". Use --elementPrefix to name element.`);\n\t\t\tprocess.exit();\n\t\t}\n\t}\n\n\treturn options;\n}\n\nfunction mergeConfigArgs(...sources: BuildArgs[]): BuildArgs {\n\treturn sources.reduce((args: BuildArgs, source: BuildArgs) => {\n\t\tObject.keys(source).forEach((key: string) => {\n\t\t\tconst value = source[key];\n\t\t\tif (typeof value !== 'undefined') {\n\t\t\t\targs[key] = source[key];\n\t\t\t}\n\t\t});\n\t\treturn args;\n\t}, Object.create(null));\n}\n\nasync function isPortAvailable(port: number): Promise<boolean> {\n\tconst server = net.createServer();\n\n\treturn new Promise<boolean>((resolve, reject) => {\n\t\tserver.once('error', function (err: any) {\n\t\t\tif (err.code === 'EADDRINUSE') {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t\telse {\n\t\t\t\treject(new Error(`Unexpected error ${err.message}`));\n\t\t\t}\n\t\t});\n\n\t\tserver.once('listening', function () {\n\t\t\tserver.close();\n\t\t\tresolve(true);\n\t\t});\n\n\t\tserver.listen(port, '127.0.0.1');\n\t});\n}\n\nasync function watch(config: webpack.Config, options: WebpackOptions, args: BuildArgs): Promise<void> {\n\tconfig.devtool = 'inline-source-map';\n\n\tconfig.entry = (function (entry) {\n\t\tif (typeof entry === 'object' && !Array.isArray(entry)) {\n\t\t\tObject.keys(entry).forEach((key) => {\n\t\t\t\tconst value = entry[key];\n\t\t\t\tif (typeof value === 'string') {\n\t\t\t\t\tentry[key] = [ 'webpack-dev-server/client?', value ];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvalue.unshift('webpack-dev-server/client?');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn entry;\n\t})(config.entry);\n\n\tconst compiler = webpack(config);\n\tconst portRange = String(args.port || defaultPortRange);\n\tlet ports: number[] = [];\n\tlet serverPort: number | undefined;\n\n\tif (portRange.indexOf(portRangeDelimeter) >= 0) {\n\t\tlet [ low, high ] = portRange.split(portRangeDelimeter).map(portStringToInt);\n\n\t\tif (high < low) {\n\t\t\t[ low, high ] = [ high, low ];\n\t\t}\n\n\t\tfor (let port = high; port >= low; port--) {\n\t\t\tports.push(port);\n\t\t}\n\t}\n\telse if (portRange.indexOf(portListDelimeter) >= 0) {\n\t\tports = portRange.split(portListDelimeter).map(portStringToInt);\n\t}\n\telse {\n\t\tports.push(portStringToInt(portRange));\n\t}\n\n\tfor (let i = 0; i < ports.length; i++) {\n\t\tif (await isPortAvailable(ports[i])) {\n\t\t\tserverPort = ports[i];\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (!serverPort) {\n\t\treturn Promise.reject(new Error(`Cannot start a build server because the port is in use, tried ${ports.join(', ')}. Do you already have a build server running?`));\n\t}\n\n\tconst server = new WebpackDevServer(compiler, options);\n\n\treturn new Promise<void>((resolve, reject) => {\n\t\tserver.listen(serverPort, (err: Error) => {\n\t\t\tconsole.log(`Starting server on http://localhost:${serverPort}`);\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t\treturn;\n\t\t\t}\n\t\t});\n\t});\n}\n\nfunction compile(config: webpack.Config, options: WebpackOptions, args: BuildArgs): Promise<void> {\n\tconst compiler = webpack(config);\n\treturn new Promise<void>((resolve, reject) => {\n\t\tcompiler.run((err, stats) => {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (stats) {\n\t\t\t\tif (config.profile) {\n\t\t\t\t\tfs.writeFileSync('dist/profile.json', JSON.stringify(stats.toJson()));\n\t\t\t\t}\n\n\t\t\t\tconsole.log(stats.toString(options.stats));\n\n\t\t\t\tif (stats.compilation && stats.compilation.errors && stats.compilation.errors.length > 0 && !args.force) {\n\t\t\t\t\treject({\n\t\t\t\t\t\texitCode: 1,\n\t\t\t\t\t\tmessage: 'The build failed with errors. Use the --force to overcome this obstacle.'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tresolve();\n\t\t});\n\t});\n}\n\nfunction buildNpmDependencies(): any {\n\ttry {\n\t\tconst packagePath = pkgDir.sync(__dirname);\n\t\tconst packageJsonFilePath = path.join(packagePath, 'package.json');\n\t\tconst packageJson = <any> require(packageJsonFilePath);\n\n\t\treturn {\n\t\t\t[packageJson.name]: packageJson.version,\n\t\t\t...packageJson.dependencies\n\t\t};\n\t}\n\tcatch (e) {\n\t\tthrow new Error('Failed reading dependencies from package.json - ' + e.message);\n\t}\n}\n\nconst command: Command<BuildArgs> = {\n\tgroup: 'build',\n\tname: 'webpack',\n\tdescription: 'create a build of your application',\n\tregister(options: OptionsHelper): void {\n\t\toptions('w', {\n\t\t\talias: 'watch',\n\t\t\tdescribe: 'watch and serve'\n\t\t});\n\n\t\toptions('p', {\n\t\t\talias: 'port',\n\t\t\tdescribe: 'port to serve on when using --watch. Can be a single port (9999), a range (9999:9990) or a list (9999,9997)',\n\t\t\ttype: 'string'\n\t\t});\n\n\t\toptions('t', {\n\t\t\talias: 'with-tests',\n\t\t\tdescribe: 'build tests as well as sources'\n\t\t});\n\n\t\toptions('locale', {\n\t\t\tdescribe: 'The default locale for the application',\n\t\t\ttype: 'string'\n\t\t});\n\n\t\toptions('supportedLocales', {\n\t\t\tdescribe: 'Any additional locales supported by the application',\n\t\t\ttype: 'array'\n\t\t});\n\n\t\toptions('messageBundles', {\n\t\t\tdescribe: 'Any message bundles to include in the build',\n\t\t\ttype: 'array'\n\t\t});\n\n\t\toptions('element', {\n\t\t\tdescribe: 'Path to a custom element descriptor factory',\n\t\t\ttype: 'string'\n\t\t});\n\n\t\toptions('elementPrefix', {\n\t\t\tdescribe: 'Output file for custom element',\n\t\t\ttype: 'string'\n\t\t});\n\n\t\toptions('debug', {\n\t\t\tdescribe: 'Generate package information useful for debugging',\n\t\t\ttype: 'boolean'\n\t\t});\n\n\t\toptions('disableLazyWidgetDetection', {\n\t\t\tdescribe: 'Disable lazy widget loading detection',\n\t\t\ttype: 'boolean'\n\t\t});\n\n\t\toptions('f', {\n\t\t\talias: 'features',\n\t\t\tdescribe: 'Features sets to optimize the build with\\n\\nValid values are: android, chrome, edge, firefox, ie11, ios, node, node8, safari',\n\t\t\ttype: 'array'\n\t\t});\n\n\t\toptions('force', {\n\t\t\tdescribe: 'Ignore build errors and use a successful return code',\n\t\t\tdefault: false,\n\t\t\ttype: 'boolean'\n\t\t});\n\t},\n\trun(helper: Helper, args: BuildArgs): Promise<void> {\n\t\tconst dojoRc = helper.configuration.get() || Object.create(null);\n\t\tconst options: WebpackOptions = {\n\t\t\tcompress: true,\n\t\t\tstats: {\n\t\t\t\tcolors: true,\n\t\t\t\tchunks: false\n\t\t\t}\n\t\t};\n\t\tconst configArgs = getConfigArgs(mergeConfigArgs(dojoRc as BuildArgs, args));\n\n\t\tif (args.watch) {\n\t\t\treturn watch(config(configArgs), options, args) as Promise<void>;\n\t\t}\n\t\telse {\n\t\t\treturn compile(config(configArgs), options, args) as Promise<void>;\n\t\t}\n\t},\n\teject(helper: Helper) {\n\t\tconst ejectOutput: EjectOutput = {\n\t\t\tnpm: {\n\t\t\t\tdevDependencies: {\n\t\t\t\t\t...buildNpmDependencies()\n\t\t\t\t}\n\t\t\t},\n\t\t\tcopy: {\n\t\t\t\tpath: __dirname,\n\t\t\t\tfiles: [\n\t\t\t\t\t'./webpack.config.js'\n\t\t\t\t]\n\t\t\t},\n\t\t\thints: [\n\t\t\t\t'to build run ' + underline('./node_modules/.bin/webpack --config ./config/build-webpack/webpack.config.js')\n\t\t\t]\n\t\t};\n\n\t\treturn ejectOutput;\n\t}\n};\nexport default command;\n"]}