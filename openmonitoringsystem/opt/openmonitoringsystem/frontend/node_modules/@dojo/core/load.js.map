{"version":3,"file":"load.js","sourceRoot":"","sources":["load.ts"],"names":[],"mappings":"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","sourcesContent":["import Promise from '@dojo/shim/Promise';\nimport { Require } from '@dojo/interfaces/loader';\nimport { isPlugin, useDefault } from './load/util';\n\ndeclare const require: Require;\n\ndeclare const define: {\n\t(...args: any[]): any;\n\tamd: any;\n};\n\nexport interface NodeRequire {\n\t(moduleId: string): any;\n}\n\nexport type Require = Require | NodeRequire;\n\nexport interface Load {\n\t(require: Require, ...moduleIds: string[]): Promise<any[]>;\n\t(...moduleIds: string[]): Promise<any[]>;\n}\n\nconst load: Load = (function (): Load {\n\tconst resolver = typeof require.toUrl === 'function' ? require.toUrl :\n\t\ttypeof (<any> require).resolve === 'function' ? (<any> require).resolve :\n\t\t(resourceId: string) => resourceId;\n\n\tfunction pluginLoad(moduleIds: string[], load: Load, loader: (modulesIds: string[]) => Promise<any>) {\n\t\tconst pluginResourceIds: string[] = [];\n\t\tmoduleIds = moduleIds.map((id: string, i: number) => {\n\t\t\tconst parts = id.split('!');\n\t\t\tpluginResourceIds[i] = parts[1];\n\t\t\treturn parts[0];\n\t\t});\n\n\t\treturn loader(moduleIds).then((modules: any[]) => {\n\t\t\tpluginResourceIds.forEach((resourceId: string, i: number) => {\n\t\t\t\tif (typeof resourceId === 'string') {\n\t\t\t\t\tconst module = modules[i];\n\t\t\t\t\tconst defaultExport = module['default'] || module;\n\n\t\t\t\t\tif (isPlugin(defaultExport)) {\n\t\t\t\t\t\tresourceId = typeof defaultExport.normalize === 'function' ?\n\t\t\t\t\t\t\tdefaultExport.normalize(resourceId, resolver) :\n\t\t\t\t\t\t\tresolver(resourceId);\n\n\t\t\t\t\t\tmodules[i] = defaultExport.load(resourceId, load);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn Promise.all(modules);\n\t\t});\n\t}\n\n\tif (typeof module === 'object' && typeof module.exports === 'object') {\n\t\treturn function load(contextualRequire: any, ...moduleIds: string[]): Promise<any[]> {\n\t\t\tif (typeof contextualRequire === 'string') {\n\t\t\t\tmoduleIds.unshift(contextualRequire);\n\t\t\t\tcontextualRequire = require;\n\t\t\t}\n\n\t\t\treturn pluginLoad(moduleIds, load, (moduleIds: string[]) => {\n\t\t\t\ttry {\n\t\t\t\t\treturn Promise.resolve(moduleIds.map(function (moduleId): any {\n\t\t\t\t\t\treturn contextualRequire(moduleId.split('!')[0]);\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\tcatch (error) {\n\t\t\t\t\treturn Promise.reject(error);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t}\n\telse if (typeof define === 'function' && define.amd) {\n\t\treturn function load(contextualRequire: any, ...moduleIds: string[]): Promise<any[]> {\n\t\t\tif (typeof contextualRequire === 'string') {\n\t\t\t\tmoduleIds.unshift(contextualRequire);\n\t\t\t\tcontextualRequire = require;\n\t\t\t}\n\n\t\t\treturn pluginLoad(moduleIds, load, (moduleIds: string[]) => {\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tlet errorHandle: { remove: () => void };\n\n\t\t\t\t\tif (typeof contextualRequire.on === 'function') {\n\t\t\t\t\t\terrorHandle = contextualRequire.on('error', (error: Error) => {\n\t\t\t\t\t\t\terrorHandle.remove();\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tcontextualRequire(moduleIds, function (...modules: any[]) {\n\t\t\t\t\t\terrorHandle && errorHandle.remove();\n\t\t\t\t\t\tresolve(modules);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t}\n\telse {\n\t\treturn function () {\n\t\t\treturn Promise.reject(new Error('Unknown loader'));\n\t\t};\n\t}\n})();\nexport default load;\n\nexport {\n\tisPlugin,\n\tuseDefault\n}\n"]}