{"version":3,"file":"loader.js","sourceRoot":"","sources":["loader.ts"],"names":[],"mappings":"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","sourcesContent":["import getFeatures from './getFeatures';\nimport * as webpack from 'webpack';\nimport * as recast from 'recast';\nimport { ExpressionStatement, BaseNode } from 'estree';\n\nconst { getOptions } = require('loader-utils');\nconst types = recast.types;\nconst namedTypes = types.namedTypes;\nconst builders = types.builders;\nconst compose = require('recast/lib/util').composeSourceMaps;\nconst { Parser } = require('acorn');\nconst dynamicImport = require('acorn-dynamic-import').default;\n\n/**\n * A map of features that should be statically replaced in the code\n */\nexport interface StaticHasFeatures {\n\t[feature: string]: boolean;\n}\n\nconst acorn = Parser.extend(dynamicImport);\n\nconst HAS_MID = /\\/has$/;\nconst HAS_PRAGMA = /^\\s*(!?)\\s*has\\s*\\([\"']([^'\"]+)['\"]\\)\\s*$/;\n\nfunction hasCheck(hasIdentifier: string, hasNamespaceIdentifier: string | undefined, args: any, callee: any) {\n\treturn (\n\t\t(namedTypes.Identifier.check(callee) && callee.name === hasIdentifier && args.length === 1) ||\n\t\t(namedTypes.MemberExpression.check(callee) &&\n\t\t\tnamedTypes.Identifier.check(callee.object) &&\n\t\t\tcallee.object.name === hasNamespaceIdentifier &&\n\t\t\tnamedTypes.Identifier.check(callee.property) &&\n\t\t\tcallee.property.name === 'default' &&\n\t\t\targs.length === 1)\n\t);\n}\n\nfunction existsCheck(existsIdentifier: string, hasNamespaceIdentifier: string | undefined, args: any, callee: any) {\n\treturn (\n\t\t(namedTypes.Identifier.check(callee) && callee.name === existsIdentifier && args.length === 1) ||\n\t\t(namedTypes.MemberExpression.check(callee) &&\n\t\t\tnamedTypes.Identifier.check(callee.object) &&\n\t\t\tcallee.object.name === hasNamespaceIdentifier &&\n\t\t\tnamedTypes.Identifier.check(callee.property) &&\n\t\t\tcallee.property.name === 'exists' &&\n\t\t\targs.length === 1)\n\t);\n}\n\nfunction addCheck(addIdentifier: string, hasNamespaceIdentifier: string | undefined, args: any, callee: any) {\n\treturn (\n\t\t(namedTypes.Identifier.check(callee) &&\n\t\t\tcallee.name === addIdentifier &&\n\t\t\t(args.length === 3 || args.length === 2)) ||\n\t\t(namedTypes.MemberExpression.check(callee) &&\n\t\t\tnamedTypes.Identifier.check(callee.object) &&\n\t\t\tcallee.object.name === hasNamespaceIdentifier &&\n\t\t\tnamedTypes.Identifier.check(callee.property) &&\n\t\t\tcallee.property.name === 'add' &&\n\t\t\t(args.length === 3 || args.length === 2))\n\t);\n}\n\nfunction getExpressionValue(node: ExpressionStatement): string | undefined {\n\tif (namedTypes.Literal.check(node.expression) && typeof node.expression.value === 'string') {\n\t\treturn node.expression.value;\n\t}\n\tif (namedTypes.TemplateLiteral.check(node.expression)) {\n\t\tif (\n\t\t\tnode.expression.quasis.length === 1 &&\n\t\t\tnamedTypes.TemplateElement.check(node.expression.quasis[0]) &&\n\t\t\ttypeof node.expression.quasis[0].value.raw === 'string'\n\t\t) {\n\t\t\treturn node.expression.quasis[0].value.raw;\n\t\t}\n\t}\n}\n\nfunction setComment<T>(\n\tnode: T,\n\tpath: recast.Path<T>,\n\tcomment: string,\n\tparentPath: recast.Path<BaseNode>,\n\tname: string,\n\treplacement: any = null\n) {\n\tconst next = (Array.isArray(parentPath.value) && parentPath.value[Number(name) + 1]) || parentPath.node;\n\tnext.comments = [...((node as any).comments || []), ...(next.comments || []), builders.commentLine(comment)];\n\tpath.replace(replacement);\n}\n\n/**\n * Checks code for usage of has pragmas or other calls to @dojo/framework/has and optimizes them out based on the flags or\n * feature sets specified statically. This loader should act on JavaScript, so it should run after the compiler\n * if using TypeScript\n * @param content The JavaScript code to optimize\n * @param sourceMap Optional Source map for the code. If provided it will be updated to reflect the optimizations made\n */\nexport default function loader(\n\tthis: webpack.loader.LoaderContext,\n\tcontent: string,\n\tsourceMap?: webpack.RawSourceMap\n): string | void {\n\tif (content.indexOf('/has') < 0 && content.indexOf('has(') < 0 && content.indexOf('exists(') < 0) {\n\t\tif (sourceMap) {\n\t\t\tthis.callback(null, content, sourceMap);\n\t\t\treturn;\n\t\t}\n\t\treturn content;\n\t}\n\t// copy features to a local scope, because `this` gets weird\n\tconst options = getOptions(this);\n\tconst { features: featuresOption } = options;\n\tconst parseOptions: any = {\n\t\tparser: {\n\t\t\tparse(source: string) {\n\t\t\t\treturn acorn.parse(source, {\n\t\t\t\t\tplugins: { dynamicImport: true },\n\t\t\t\t\tlocations: true,\n\t\t\t\t\tsourceType: 'module'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\tif (sourceMap) {\n\t\tparseOptions.sourceFileName = sourceMap.file;\n\t}\n\tconst dynamicFlags = new Set<string>();\n\tconst ast = recast.parse(content, parseOptions);\n\tlet features: StaticHasFeatures;\n\tlet elideNextImport = false;\n\tlet hasIdentifier: string | undefined;\n\tlet hasNamespaceIdentifier: string | undefined;\n\tlet existsIdentifier: string | undefined;\n\tlet addIdentifier: string | undefined;\n\tlet comment: string | undefined;\n\tif (!featuresOption || Array.isArray(featuresOption) || typeof featuresOption === 'string') {\n\t\tfeatures = getFeatures(featuresOption);\n\t} else {\n\t\tfeatures = featuresOption;\n\t}\n\n\ttypes.visit(ast, {\n\t\tvisitExpressionStatement(path) {\n\t\t\tconst { node, parentPath, name } = path;\n\t\t\tconst expressionValue = getExpressionValue(node);\n\t\t\tif (expressionValue) {\n\t\t\t\tconst hasPragma = HAS_PRAGMA.exec(expressionValue);\n\t\t\t\tif (hasPragma) {\n\t\t\t\t\tconst [, negate, flag] = hasPragma;\n\t\t\t\t\tcomment = ` ${negate}has('${flag}')`;\n\t\t\t\t\tif (flag in features) {\n\t\t\t\t\t\telideNextImport = negate ? !!features[flag] : !features[flag];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tnamedTypes.CallExpression.check(node.expression) &&\n\t\t\t\tnamedTypes.Identifier.check(node.expression.callee)\n\t\t\t) {\n\t\t\t\tif (\n\t\t\t\t\tnode.expression.callee.name === 'require' &&\n\t\t\t\t\tnode.expression.arguments.length === 1 &&\n\t\t\t\t\telideNextImport === true\n\t\t\t\t) {\n\t\t\t\t\tconst [arg] = node.expression.arguments;\n\t\t\t\t\tif (namedTypes.Literal.check(arg)) {\n\t\t\t\t\t\tcomment = ` elided: import '${arg.value}'`;\n\t\t\t\t\t\telideNextImport = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (comment && parentPath && typeof name !== 'undefined') {\n\t\t\t\tsetComment(node, path, comment, parentPath, name);\n\t\t\t\tcomment = undefined;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tcomment = undefined;\n\t\t\tthis.traverse(path);\n\t\t},\n\n\t\tvisitDeclaration(path) {\n\t\t\tconst { node, parentPath, name } = path;\n\t\t\tif (namedTypes.ImportDeclaration.check(path.node)) {\n\t\t\t\tconst value = path.node.source.value;\n\n\t\t\t\tif (elideNextImport) {\n\t\t\t\t\tcomment = ` elided: import '${value}'`;\n\t\t\t\t\telideNextImport = false;\n\t\t\t\t}\n\t\t\t\tif (comment && parentPath && typeof name !== 'undefined') {\n\t\t\t\t\tlet replacement: any = null;\n\t\t\t\t\tif (path.node.specifiers.length) {\n\t\t\t\t\t\treplacement = builders.variableDeclaration(\n\t\t\t\t\t\t\t'var',\n\t\t\t\t\t\t\tpath.node.specifiers.map((specifier) => {\n\t\t\t\t\t\t\t\treturn builders.variableDeclarator(specifier.local, builders.identifier('undefined'));\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tsetComment(node, path, comment, parentPath, name, replacement);\n\t\t\t\t\tcomment = undefined;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tcomment = undefined;\n\n\t\t\t\tif (typeof value === 'string' && HAS_MID.test(value)) {\n\t\t\t\t\tpath.node.specifiers.forEach((specifier) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tspecifier.type === 'ImportDefaultSpecifier' ||\n\t\t\t\t\t\t\t(specifier.type === 'ImportSpecifier' && specifier.imported.name === 'default')\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\thasIdentifier = specifier.local.name;\n\t\t\t\t\t\t} else if (specifier.type === 'ImportNamespaceSpecifier') {\n\t\t\t\t\t\t\thasNamespaceIdentifier = specifier.local.name;\n\t\t\t\t\t\t} else if (specifier.type === 'ImportSpecifier' && specifier.imported.name === 'exists') {\n\t\t\t\t\t\t\texistsIdentifier = specifier.local.name;\n\t\t\t\t\t\t} else if (specifier.type === 'ImportSpecifier' && specifier.imported.name === 'add') {\n\t\t\t\t\t\t\taddIdentifier = specifier.local.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.traverse(path);\n\t\t},\n\n\t\t// Look for `require('*/has');` and set the variable name to `hasNamespaceIdentifier`\n\t\tvisitVariableDeclaration(path) {\n\t\t\tconst {\n\t\t\t\tname,\n\t\t\t\tnode,\n\t\t\t\tparentPath,\n\t\t\t\tparentPath: { node: parentNode },\n\t\t\t\tnode: { declarations }\n\t\t\t} = path;\n\n\t\t\tlet identifier: any = undefined;\n\n\t\t\tif (elideNextImport === true && declarations.length === 1) {\n\t\t\t\tconst callExpression = declarations[0];\n\t\t\t\tif (namedTypes.VariableDeclarator.check(callExpression)) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tcallExpression.init &&\n\t\t\t\t\t\tnamedTypes.CallExpression.check(callExpression.init) &&\n\t\t\t\t\t\tnamedTypes.Identifier.check(callExpression.init.callee)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcallExpression.init.callee.name === 'require' &&\n\t\t\t\t\t\t\tcallExpression.init.arguments.length === 1\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tif (callExpression.id) {\n\t\t\t\t\t\t\t\tidentifier = callExpression.id;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst [arg] = callExpression.init.arguments;\n\t\t\t\t\t\t\tif (namedTypes.Literal.check(arg)) {\n\t\t\t\t\t\t\t\tcomment = ` elided: import '${arg.value}'`;\n\t\t\t\t\t\t\t\telideNextImport = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (comment && parentPath && typeof name !== 'undefined') {\n\t\t\t\t\tconst replacement = builders.variableDeclaration('var', [\n\t\t\t\t\t\tbuilders.variableDeclarator(identifier, builders.identifier('undefined'))\n\t\t\t\t\t]);\n\t\t\t\t\tsetComment(node, path, comment, parentPath, name, replacement);\n\n\t\t\t\t\tcomment = undefined;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tcomment = undefined;\n\t\t\t}\n\n\t\t\t// Get all the top level variable declarations\n\t\t\tif (ast.program === parentNode && !hasNamespaceIdentifier) {\n\t\t\t\tdeclarations.forEach(({ id, init }) => {\n\t\t\t\t\tif (!hasNamespaceIdentifier) {\n\t\t\t\t\t\tif (namedTypes.Identifier.check(id) && init && namedTypes.CallExpression.check(init)) {\n\t\t\t\t\t\t\tconst { callee, arguments: args } = init;\n\t\t\t\t\t\t\tif (namedTypes.Identifier.check(callee) && callee.name === 'require' && args.length === 1) {\n\t\t\t\t\t\t\t\tconst [arg] = args;\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tnamedTypes.Literal.check(arg) &&\n\t\t\t\t\t\t\t\t\ttypeof arg.value === 'string' &&\n\t\t\t\t\t\t\t\t\tHAS_MID.test(arg.value)\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\thasNamespaceIdentifier = id.name;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.traverse(path);\n\t\t}\n\t});\n\n\t// Now we want to walk the AST and find an expressions where the default import or `exists` of `*/has` is\n\t// called. This will be a CallExpression, where the callee is an object named the import from above\n\t// accessing the `default` or `exists` properties, with one argument, which is a string literal.\n\tif (hasIdentifier || hasNamespaceIdentifier || existsIdentifier || addIdentifier) {\n\t\ttypes.visit(ast, {\n\t\t\tvisitCallExpression(path) {\n\t\t\t\tconst {\n\t\t\t\t\tnode: { arguments: args, callee }\n\t\t\t\t} = path;\n\t\t\t\tconst isHasCheck = hasCheck(hasIdentifier as string, hasNamespaceIdentifier, args, callee);\n\t\t\t\tconst isExistsCheck = existsCheck(\n\t\t\t\t\texistsIdentifier as string,\n\t\t\t\t\thasNamespaceIdentifier as string,\n\t\t\t\t\targs,\n\t\t\t\t\tcallee\n\t\t\t\t);\n\t\t\t\tconst isAdd = addCheck(addIdentifier as string, hasNamespaceIdentifier, args, callee);\n\t\t\t\tif (isHasCheck || isExistsCheck) {\n\t\t\t\t\tconst [arg] = args;\n\t\t\t\t\tif (namedTypes.Literal.check(arg) && typeof arg.value === 'string') {\n\t\t\t\t\t\t// check to see if we have a flag that we want to statically swap\n\t\t\t\t\t\tif (arg.value in features) {\n\t\t\t\t\t\t\tpath.replace(builders.literal(isExistsCheck ? true : features[arg.value]));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdynamicFlags.add(arg.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (isAdd) {\n\t\t\t\t\tconst [feature] = args;\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tnamedTypes.Literal.check(feature) &&\n\t\t\t\t\t\ttypeof feature.value === 'string' &&\n\t\t\t\t\t\tfeature.value in features\n\t\t\t\t\t) {\n\t\t\t\t\t\tpath.replace(\n\t\t\t\t\t\t\tbuilders.callExpression(callee, [args[0], builders.literal(features[feature.value])])\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tthis.traverse(path);\n\t\t\t}\n\t\t});\n\t}\n\n\tif (dynamicFlags.size > 0) {\n\t\tconsole.log();\n\t\tconsole.log('Dynamic features: ' + Array.from(dynamicFlags).join(', '));\n\t\tconsole.log();\n\t}\n\tif (sourceMap) {\n\t\tconst result = recast.print(ast, { sourceMapName: sourceMap.file });\n\t\tconst map = compose(\n\t\t\tsourceMap,\n\t\t\tresult.map\n\t\t);\n\t\tthis.callback(null, result.code, map);\n\t\treturn;\n\t}\n\treturn recast.print(ast).code;\n}\n"]}