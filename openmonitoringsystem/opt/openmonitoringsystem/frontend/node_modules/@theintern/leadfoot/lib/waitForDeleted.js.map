{"version":3,"file":"waitForDeleted.js","sourceRoot":"","sources":["../../../src/lib/waitForDeleted.ts"],"names":[],"mappings":";;AAAA,8CAAyC;AACzC,6CAAwC;AAuBxC,wBACC,OAAgB,EAChB,OAA0B,EAC1B,KAAe,EACf,KAAa;IAEb,IAAI,eAAuB,CAAC;IAE5B,MAAM,CAAC,OAAO;SACZ,UAAU,CAAC,UAAU,CAAC;SACtB,IAAI,CAAC,UAAA,KAAK;QACV,eAAe,GAAG,KAAK,CAAC;QACxB,OAAO,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;IACnC,CAAC,CAAC;SACD,IAAI,CAAC;QACL,MAAM,CAAC,IAAI,cAAI,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,IAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;YAE7B,CAAC;gBACA,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,SAAS,GAAG,eAAe,CAAC,CAAC,CAAC;oBAC9C,IAAM,MAAM,GAAG;wBACd,IAAM,KAAK,GAAQ,IAAI,KAAK,EAAE,CAAC;wBAC/B,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC;wBACZ,IAAA,wCAEL,EAFM,YAAI,EAAE,eAAO,CAElB;wBACF,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC;wBAClB,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;wBACxB,MAAM,CAAC,KAAK,CAAC,CAAC;oBACf,CAAC,CAAC;oBACF,OAAO;yBACL,UAAU,CAAC,UAAU,EAAE,eAAe,CAAC;yBACvC,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;oBACvB,MAAM,CAAC;gBACR,CAAC;gBAED,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,UAAS,KAAK;oBACnD,IAAM,MAAM,GAAG;wBAEd,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,KAAK,eAAe,CAAC,CAAC,CAAC;4BACpC,OAAO,EAAE,CAAC;wBACX,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACP,MAAM,CAAC,KAAK,CAAC,CAAC;wBACf,CAAC;oBACF,CAAC,CAAC;oBACF,OAAO;yBACL,UAAU,CAAC,UAAU,EAAE,eAAe,CAAC;yBACvC,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;gBACxB,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC,EAAE,CAAC;QACN,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC;SACD,IAAI,CAAC,cAAO,CAAC,CAAC,CAAC;AAClB,CAAC;AArDD,iCAqDC","sourcesContent":["import Task from '@dojo/core/async/Task';\nimport statusCodes from './statusCodes';\nimport Session from '../Session';\nimport Element from '../Element';\n\nimport { Strategy } from './Locator';\n\n/**\n * Waits for all elements findable in the currently active window/frame\n * using the given strategy and value to be destroyed.\n *\n * @param session The session to consider.\n *\n * @param locator The particular instance that will perform the locating.\n *\n * @param using The element retrieval strategy to use. See\n * [[Command.Command.find]] for options.\n *\n * @param value The strategy-specific value to search for. See\n * [[Command.Command.find]] for details.\n *\n * @returns a Task that resolves when no matching elements can be found, or\n * rejects if matching elements still exist after the find timeout.\n */\nexport default function waitForDeleted(\n\tsession: Session,\n\tlocator: Session | Element,\n\tusing: Strategy,\n\tvalue: string\n) {\n\tlet originalTimeout: number;\n\n\treturn session\n\t\t.getTimeout('implicit')\n\t\t.then(value => {\n\t\t\toriginalTimeout = value;\n\t\t\tsession.setTimeout('implicit', 0);\n\t\t})\n\t\t.then(function() {\n\t\t\treturn new Task((resolve, reject) => {\n\t\t\t\tconst startTime = Date.now();\n\n\t\t\t\t(function poll() {\n\t\t\t\t\tif (Date.now() - startTime > originalTimeout) {\n\t\t\t\t\t\tconst always = function() {\n\t\t\t\t\t\t\tconst error: any = new Error();\n\t\t\t\t\t\t\terror.status = 21;\n\t\t\t\t\t\t\tconst [name, message] = (<any>statusCodes)[\n\t\t\t\t\t\t\t\terror.status\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\terror.name = name;\n\t\t\t\t\t\t\terror.message = message;\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tsession\n\t\t\t\t\t\t\t.setTimeout('implicit', originalTimeout)\n\t\t\t\t\t\t\t.then(always, always);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlocator.find(using, value).then(poll, function(error) {\n\t\t\t\t\t\tconst always = function() {\n\t\t\t\t\t\t\t/* istanbul ignore else: other errors should never occur during normal operation */\n\t\t\t\t\t\t\tif (error.name === 'NoSuchElement') {\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tsession\n\t\t\t\t\t\t\t.setTimeout('implicit', originalTimeout)\n\t\t\t\t\t\t\t.then(always, always);\n\t\t\t\t\t});\n\t\t\t\t})();\n\t\t\t});\n\t\t})\n\t\t.then(() => {});\n}\n"]}